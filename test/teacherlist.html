<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç RPM ‚Äî –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</title>
  <link rel="icon" href="img/UniLogo.png" type="image/png">
  <style>
    :root{
      --bg:#070912;
      --panel:#0f1324cc;
      --text:#e9ecff;
      --muted:#9aa3c7;
      --accent:#7aa2ff;
      --gold:#ffd369;
      --dean:#ff3b6b;
      --zam:#ffd369;
      --teacher:#4aa8ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 70% 10%, #121831 0%, #070912 55%) fixed;
      overflow:hidden;
    }

    header{
      position:fixed; inset:16px 16px auto 16px;
      background:linear-gradient(180deg,#121733aa,#0b0f1f99);
      border:1px solid #1c2347; backdrop-filter: blur(8px);
      border-radius:18px; padding:12px 16px; z-index:10;
      display:flex; gap:14px; align-items:center; box-shadow:0 10px 40px #0008;
    }
    header h1{
      margin:0; font-size:16px; letter-spacing:.3px; color:#cfd6ff; font-weight:700;
    }
    .tag{
      font:600 12px/1 system-ui; color:#99a3d1; padding:6px 10px; border-radius:999px;
      border:1px solid #2a3263; background:#0e1230cc;
    }
    .controls{
      margin-left:auto; display:flex; gap:8px;
    }
    .btn{
      cursor:pointer; border:none; border-radius:12px; padding:8px 12px; font-weight:700;
      color:#fff; background:linear-gradient(135deg,#6ea1ff,#4e7bff); box-shadow:0 6px 20px #4e7bff55;
      transition:transform .15s ease, box-shadow .15s ease, opacity .2s;
    }
    .btn:hover{ transform:translateY(-1px); box-shadow:0 10px 28px #4e7bff66;}
    .btn:active{ transform:translateY(0); opacity:.9 }

    #date{
      margin-left:8px; color:var(--muted); font-weight:600; letter-spacing:.2px;
    }

    #legend{
      position:fixed; right:16px; top:16px; z-index:10;
      background:var(--panel); border:1px solid #1b2142; border-radius:18px;
      padding:12px 14px; display:flex; gap:14px; align-items:center;
      box-shadow:0 10px 40px #0008;
    }
    .dot{ width:10px; height:10px; border-radius:50%;}
    .row{ display:flex; align-items:center; gap:8px; color:#c8cffc; font-size:12px; }

    #side{
      position:fixed; right:16px; bottom:16px; z-index:10;
      width:280px; max-width:calc(100vw - 32px);
      background:var(--panel); border:1px solid #1b2142; border-radius:18px;
      padding:14px; display:none; box-shadow:0 10px 40px #0008;
    }
    #side.active{ display:block; }
    #side img{ width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:14px; border:1px solid #202858; }
    #side h3{ margin:10px 0 4px; font-size:16px; }
    #side p{ margin:0; color:#a7b0db; font-size:13px; }

    canvas{ display:block; position:fixed; inset:0; }

    /* –∫—Ä–∞—Å–∏–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ */
    .hint{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background:#0b0f1fbb; border:1px solid #1a2147; border-radius:999px; padding:8px 12px;
      color:#b6c0ef; font-size:12px; z-index:10; user-select:none;
      box-shadow:0 8px 30px #0008;
    }
    @media (max-width:720px){
      #legend{ display:none; }
      #side{ width:auto; }
      header{ inset:8px }
    }
  </style>
</head>
<body>
  <header>
    <h1>–û—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞</h1>
    <span class="tag">–õ–ö–ú ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</span>
    <span class="tag">–õ–ö–ú –ø–æ –∫—Ä—É–≥—É ‚Äî —Ç–∞—Å–∫–∞—Ç—å —É–∑–µ–ª</span>
    <span id="date" class="tag">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span>
    <div class="controls">
      <button class="btn" id="prevBtn">‚üµ –ù–∞–∑–∞–¥</button>
      <button class="btn" id="nextBtn">–í–ø–µ—Ä—ë–¥ ‚ü∂</button>
      <button class="btn" id="shuffleBtn" title="–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –¥–ª–∏–Ω—ã">üé≤ –î–ª–∏–Ω—ã</button>
      <button class="btn" id="resetViewBtn" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞–Ω–æ—Ä–∞–º—É">üîÑ –í–∏–¥</button>
    </div>
  </header>

  <div id="legend">
    <div class="row"><span class="dot" style="background:var(--dean)"></span><span>–î–µ–∫–∞–Ω</span></div>
    <div class="row"><span class="dot" style="background:var(--zam)"></span><span>–ó–∞–º. –¥–µ–∫–∞–Ω–∞</span></div>
    <div class="row"><span class="dot" style="background:var(--teacher)"></span><span>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</span></div>
    <div class="row"><span class="dot" style="background:linear-gradient(90deg,var(--gold),#ffffff)"></span><span>–°–≤—è–∑–∏</span></div>
  </div>

  <div id="side">
    <img id="sideImg" alt="">
    <h3 id="sideName">‚Äî</h3>
    <p id="sideRole">‚Äî</p>
  </div>

  <div class="hint">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π —Ñ–æ–Ω –õ–ö–ú, –∞ –∫—Ä—É–∂–∫–∏ ‚Äî —Ö–≤–∞—Ç–∞–π –∏ —Ç–∞—Å–∫–∞–π. –ö–ª–∏–∫ –ø–æ –∫—Ä—É–≥—É ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É.</div>

  <canvas id="stars"></canvas>
  <canvas id="graph"></canvas>

  <script>
  // ========= –£–¢–ò–õ–´ =========
  const lerp=(a,b,t)=>a+(b-a)*t;
  const rand=(a,b)=>Math.random()*(b-a)+a;
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const TAU=Math.PI*2;

  // ========= –ó–í–Å–ó–î–´ =========
  const starCanvas=document.getElementById('stars');
  const starCtx=starCanvas.getContext('2d');
  let stars=[];
  function resizeStars(){
    starCanvas.width=innerWidth; starCanvas.height=innerHeight;
    const n= Math.round((innerWidth*innerHeight)/9000);
    stars = Array.from({length:n},()=>({
      x:Math.random()*innerWidth,
      y:Math.random()*innerHeight,
      r:Math.random()*1.8+0.2,
      s:Math.random()*0.6+0.2  // speed parallax
    }));
  }
  function drawStars(offset){
    starCtx.clearRect(0,0,starCanvas.width,starCanvas.height);
    starCtx.globalCompositeOperation='lighter';
    for(const s of stars){
      const x = (s.x - offset.x*s.s)%starCanvas.width;
      const y = (s.y - offset.y*s.s)%starCanvas.height;
      starCtx.beginPath();
      starCtx.arc(x<0?x+starCanvas.width:x, y<0?y+starCanvas.height:y, s.r, 0, TAU);
      starCtx.fillStyle='rgba(200,220,255,.9)';
      starCtx.fill();
    }
    starCtx.globalCompositeOperation='source-over';
  }

  // ========= –ì–†–ê–§ =========
  const canvas=document.getElementById('graph');
  const ctx=canvas.getContext('2d');
  function resizeGraph(){ canvas.width=innerWidth; canvas.height=innerHeight; }
  window.addEventListener('resize',()=>{ resizeStars(); resizeGraph(); });

  // –∫–∞–º–µ—Ä—É –º–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å
  const camera = { x:0, y:0, scale:1 };

  // –î–∞–Ω–Ω—ã–µ
  let periods=[], current=0;

  // –£–∑–ª—ã/—Å–≤—è–∑–∏
  let nodes=[], links=[];

  // –§–∏–∑–∏–∫–∞
  const SPRING_K = 0.004;           // –∂—ë—Å—Ç–∫–æ—Å—Ç—å –ø—Ä—É–∂–∏–Ω—ã
  const REPULSE = 11000;            // —Å–∏–ª–∞ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏—è
  const FRICTION = 0.85;            // —Ç—Ä–µ–Ω–∏–µ
  const CENTERING = 0.002;          // —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏

  // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
  let dragNode=null;
  let isPanning=false;
  let panStart={x:0,y:0};
  let cameraStart={x:0,y:0};

  // –ö–∞—Ä—Ç–æ—á–∫–∞
  const side = {
    el: document.getElementById('side'),
    img: document.getElementById('sideImg'),
    name: document.getElementById('sideName'),
    role: document.getElementById('sideRole'),
    open(n){
      this.img.src=n.img; this.name.textContent=n.name;
      this.role.textContent = n.role==='dean'?'–î–µ–∫–∞–Ω': n.role==='zam'?'–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –¥–µ–∫–∞–Ω–∞':'–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å';
      this.el.classList.add('active');
    }
  };

  // =========== –ó–ê–ì–†–£–ó–ö–ê ===========
  async function load(){
    resizeStars(); resizeGraph();
    const res = await fetch('staff.json'); // —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: [{range, staff:[{role,img,name},...]}, ...] :contentReference[oaicite:2]{index=2}
    periods = await res.json();
    buildFromPeriod(0);
    document.getElementById('prevBtn').onclick=()=>switchPeriod(-1);
    document.getElementById('nextBtn').onclick=()=>switchPeriod(+1);
    document.getElementById('shuffleBtn').onclick=()=>randomizeLinkLengths(true);
    document.getElementById('resetViewBtn').onclick=resetView;
    loop();
  }

  function switchPeriod(dir){
    current = (current + dir + periods.length) % periods.length;
    buildFromPeriod(current);
  }

  function buildFromPeriod(i){
    const period = periods[i];
    document.getElementById('date').textContent = period.range;
    const staff = period.staff.map(p=>({ id:p.name, name:p.name, role:p.role, img:p.img }));

    // –Ω–∞–π—Ç–∏ –¥–µ–∫–∞–Ω–∞
    const dean = staff.find(p=>p.role==='dean');
    // —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —É–∑–ª—ã
    nodes = staff.map((p,idx)=>({
      id:p.id, name:p.name, role:p.role, img:p.img,
      x: innerWidth/2 + Math.cos(idx)*rand(40,140),
      y: innerHeight/2 + Math.sin(idx)*rand(40,140),
      vx:0, vy:0, r: p.role==='dean'? 42 : p.role==='zam'? 34 : 30
    }));

    // —Å–≤—è–∑–∏: –≤—Å–µ -> –¥–µ–∫–∞–Ω; —É –∑–∞–º–æ–≤ ‚Äî —Ç–∏–ø 'zam' (–∑–æ–ª–æ—Ç—ã–µ –ª–∏–Ω–∏–∏), —É –ø—Ä–µ–ø–æ–¥–æ–≤ ‚Äî 'teacher' (–±–µ–ª—ã–µ)
    links = [];
    if(dean){
      for(const p of staff){
        if(p===dean) continue;
        links.push({
          a: p.name, b: dean.name,
          type: (p.role==='zam' ? 'zam' : 'teacher'),
          len: rand(140, 320),       // –°–õ–£–ß–ê–ô–ù–´–ï –¥–ª–∏–Ω—ã —Å–≤—è–∑–µ–π
          w: rand(1.2, 3.0)          // —Å–ª–µ–≥–∫–∞ —Ä–∞–∑–Ω–∞—è —Ç–æ–ª—â–∏–Ω–∞ –¥–ª—è —ç—Å—Ç–µ—Ç–∏–∫–∏
        });
      }
    }
    resetView();
  }

  function randomizeLinkLengths(jump=false){
    for(const L of links){
      L.len = rand(140, 320);
      L.w = rand(1.2,3.0);
    }
    if(jump){
      // –ª—ë–≥–∫–∏–π ¬´–ø–∏–Ω–æ–∫¬ª, —á—Ç–æ–±—ã –≥—Ä–∞—Ñ –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏–ª—Å—è
      for(const n of nodes){ n.vx += rand(-2,2); n.vy += rand(-2,2); }
    }
  }

  function resetView(){ camera.x=0; camera.y=0; camera.scale=1; }

  // ========= –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï =========
  function nodeById(id){ return nodes.find(n=>n.id===id); }

  function roleColor(role){
    if(role==='dean') return getComputedStyle(document.documentElement).getPropertyValue('--dean').trim();
    if(role==='zam') return getComputedStyle(document.documentElement).getPropertyValue('--zam').trim();
    return getComputedStyle(document.documentElement).getPropertyValue('--teacher').trim();
  }

  // –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  const imageCache = new Map();
  function getImage(src){
    if(imageCache.has(src)) return imageCache.get(src);
    const img = new Image(); img.src=src;
    imageCache.set(src,img); return img;
  }

  // ========= –ò–ù–ü–£–¢ =========
  canvas.addEventListener('mousedown', (e)=>{
    const p = screenToWorld(e.clientX, e.clientY);
    dragNode = pickNode(p.x, p.y);
    if(dragNode){
      isPanning=false;
    }else{
      isPanning=true;
      panStart={x:e.clientX, y:e.clientY};
      cameraStart={x:camera.x, y:camera.y};
    }
  });
  canvas.addEventListener('mousemove', (e)=>{
    if(dragNode){
      const p = screenToWorld(e.clientX, e.clientY);
      dragNode.x = p.x; dragNode.y = p.y;
      dragNode.vx = 0; dragNode.vy = 0;
    }else if(isPanning){
      camera.x = cameraStart.x - (e.clientX - panStart.x)/camera.scale;
      camera.y = cameraStart.y - (e.clientY - panStart.y)/camera.scale;
    }
  });
  window.addEventListener('mouseup', ()=>{ dragNode=null; isPanning=false; });

  canvas.addEventListener('click', (e)=>{
    const p = screenToWorld(e.clientX, e.clientY);
    const n = pickNode(p.x, p.y);
    if(n){ side.open(n); }
  });

  // –∫–æ–ª—ë—Å–∏–∫–æ ‚Äî –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø—Ä–∏—è—Ç–Ω–æ
  canvas.addEventListener('wheel', (e)=>{
    e.preventDefault();
    const mouse = screenToWorld(e.clientX, e.clientY);
    const s0 = camera.scale;
    const factor = Math.exp(-e.deltaY*0.0015);
    camera.scale = clamp(camera.scale*factor, 0.4, 2.5);
    // –∑—É–º –∫ –∫—É—Ä—Å–æ—Ä—É
    camera.x = mouse.x - (mouse.x - camera.x) * (s0/camera.scale);
    camera.y = mouse.y - (mouse.y - camera.y) * (s0/camera.scale);
  }, {passive:false});

  function pickNode(x,y){
    for(let i=nodes.length-1;i>=0;i--){
      const n=nodes[i];
      const dx=x-n.x, dy=y-n.y;
      if(dx*dx+dy*dy <= (n.r+6)*(n.r+6)) return n;
    }
    return null;
  }

  function screenToWorld(sx,sy){
    return { x: sx/camera.scale + camera.x, y: sy/camera.scale + camera.y };
  }

  // ========= –°–ò–ú–£–õ–Ø–¶–ò–Ø =========
  function stepPhysics(dt){
    // –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ
    for(let i=0;i<nodes.length;i++){
      for(let j=i+1;j<nodes.length;j++){
        const a=nodes[i], b=nodes[j];
        let dx=a.x-b.x, dy=a.y-b.y;
        let d2 = dx*dx+dy*dy;
        let d = Math.sqrt(d2)+0.001;
        const minDist = (a.r+b.r)+18;
        if(d < minDist) {
          // –º—è–≥–∫–æ–µ —Ç–æ–ª–∫–∞–Ω–∏–µ
          const f = (minDist - d)*0.02;
          dx/=d; dy/=d;
          a.x += dx*f; a.y += dy*f;
          b.x -= dx*f; b.y -= dy*f;
        } else {
          // –∫—É–ª–æ–Ω–æ–≤—Å–∫–æ–µ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ
          const f = REPULSE/d2;
          dx/=d; dy/=d;
          a.vx += dx*f; a.vy += dy*f;
          b.vx -= dx*f; b.vy -= dy*f;
        }
      }
    }
    // –ø—Ä—É–∂–∏–Ω—ã –∫ –¥–µ–∫–∞–Ω—É (–∫–∞–∂–¥–∞—è —Å–≤—è–∑—å)
    for(const L of links){
      const A=nodeById(L.a), B=nodeById(L.b);
      let dx=A.x-B.x, dy=A.y-B.y;
      let d=Math.sqrt(dx*dx+dy*dy)+0.001;
      const ext = d - L.len;           // –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ä–∞—Å—Ç—è–Ω—É–ª–∞—Å—å
      const f = SPRING_K*ext;
      dx/=d; dy/=d;
      // —Ç—è–Ω–µ–º –∫ –∂–µ–ª–∞–µ–º–æ–π –¥–ª–∏–Ω–µ
      A.vx -= dx*f; A.vy -= dy*f;
      B.vx += dx*f; B.vy += dy*f;
    }
    // —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É
    const targetX = innerWidth/2 + camera.x;
    const targetY = innerHeight/2 + camera.y;
    for(const n of nodes){
      n.vx += (targetX - n.x)*CENTERING;
      n.vy += (targetY - n.y)*CENTERING;
    }
    // –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    for(const n of nodes){
      n.x += n.vx*dt; n.y += n.vy*dt;
      n.vx *= FRICTION; n.vy *= FRICTION;
    }
  }

  // ========= –†–ï–ù–î–ï–† =========
  function draw(){
    ctx.setTransform(camera.scale,0,0,camera.scale, -camera.x*camera.scale, -camera.y*camera.scale);
    // —Ñ–æ–Ω –∑–≤—ë–∑–¥ —Å –ø–∞—Ä–∞–ª–ª–∞–∫—Å–æ–º
    drawStars({x:camera.x, y:camera.y});

    // —Å–≤—è–∑–∏
    for(const L of links){
      const A=nodeById(L.a), B=nodeById(L.b);
      const grad = ctx.createLinearGradient(A.x,A.y,B.x,B.y);
      if(L.type==='zam'){ grad.addColorStop(0,'#ffe08a'); grad.addColorStop(1,'#ffbb33'); }
      else{ grad.addColorStop(0,'#e9f0ff'); grad.addColorStop(1,'#94a6ff'); }
      ctx.lineWidth=L.w;
      ctx.strokeStyle=grad;
      ctx.globalAlpha=0.95;
      ctx.beginPath(); ctx.moveTo(A.x,A.y); ctx.lineTo(B.x,B.y); ctx.stroke();
      ctx.globalAlpha=1;
    }

    // —É–∑–ª—ã
    for(const n of nodes){
      // –æ—Ä–µ–æ–ª
      ctx.beginPath(); ctx.arc(n.x,n.y,n.r+10,0,TAU);
      ctx.fillStyle = 'rgba(120,160,255,0.04)'; ctx.fill();

      // –≤–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥
      ctx.beginPath(); ctx.arc(n.x,n.y,n.r,0,TAU);
      ctx.fillStyle=roleColor(n.role); ctx.fill();

      // –æ–±–≤–æ–¥–∫–∞
      ctx.lineWidth=2.5; ctx.strokeStyle='rgba(255,255,255,.9)'; ctx.stroke();

      // –º–∞—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∫—Ä—É–≥)
      const img = getImage(n.img);
      const size = n.r*1.4;
      ctx.save();
      ctx.beginPath(); ctx.arc(n.x,n.y,n.r-4,0,TAU); ctx.clip();
      ctx.drawImage(img, n.x-size/2, n.y-size/2, size, size);
      ctx.restore();

      // –ø–æ–¥–ø–∏—Å—å
      ctx.font='600 12px system-ui';
      ctx.textAlign='center'; ctx.textBaseline='top';
      ctx.fillStyle='rgba(210,220,255,.95)';
      ctx.fillText(n.name, n.x, n.y+n.r+8);
    }
  }

  // ========= –¶–ò–ö–õ =========
  let last=performance.now();
  function loop(now=performance.now()){
    const dt = clamp((now-last)/16, 0.5, 2.0); last=now;
    stepPhysics(dt);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    draw();
    requestAnimationFrame(loop);
  }

  // –ü—É—Å–∫
  load();
  </script>
</body>
</html>
