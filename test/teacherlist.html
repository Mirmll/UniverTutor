<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Teacher Graph</title>
  <style>
    body {
      margin: 0;
      background: #0b1a2e;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
    }
    select {
      padding: 5px;
      font-size: 14px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label>Выбери период:</label>
    <select id="rangeSelect"></select>
  </div>
  <canvas id="canvas"></canvas>

  <script>
    // ========== ТВОЙ JSON ==========

    const data = [
      {
        "range": "11.08.2025 – 11.09.2025",
        "staff": [
          { "id": "dean1", "role": "dean", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam1", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam2", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach1", "role": "teacher", "img": "img/toxic_2k72.png", "name": "Кейт Шэдоу" },
          { "id": "teach2", "role": "teacher", "img": "img/zxczapoy.png", "name": "Кими Старк" },
          { "id": "teach3", "role": "teacher", "img": "img/ranger113.png", "name": "Кирилл Агнес-Степ" },
          { "id": "teach4", "role": "teacher", "img": "img/Tinaida.png", "name": "Тинаида Добренко" },
          { "id": "teach5", "role": "teacher", "img": "img/AkAi_KyOui.png", "name": "Эвелина Алакрити" },
          { "id": "teach6", "role": "teacher", "img": "img/askalinka_mf.png", "name": "Алия Блейз" },
          { "id": "teach7", "role": "teacher", "img": "img/AnnetKariborro.png", "name": "Агнесс Фальконе" },
          { "id": "teach8", "role": "teacher", "img": "img/Boond007.png", "name": "Даниэль Кобблпот" },
          { "id": "teach9", "role": "teacher", "img": "img/new_stalker3.png", "name": "Трафальгар Культапкин" },
          { "id": "teach10", "role": "teacher", "img": "img/klybhuzka.png", "name": "Ирина Коркина-Коннелли" },
          { "id": "teach11", "role": "teacher", "img": "img/GamerProd.png", "name": "Такеши Мейс" },
          { "id": "teach12", "role": "teacher", "img": "img/Abrikos_ikk.png", "name": "Дин Орлеан-Лоусон" },
          { "id": "teach13", "role": "teacher", "img": "img/Prosto_VaraG.png", "name": "Варвара Уайт" }
        ],
        "links": [
          { "source": "dean1", "target": "zam1" },
          { "source": "dean1", "target": "zam2" },
          { "source": "dean1", "target": "teach1" },
          { "source": "dean1", "target": "teach2" },
          { "source": "dean1", "target": "teach3" },
          { "source": "dean1", "target": "teach4" },
          { "source": "dean1", "target": "teach5" },
          { "source": "dean1", "target": "teach6" },
          { "source": "dean1", "target": "teach7" },
          { "source": "dean1", "target": "teach8" },
          { "source": "dean1", "target": "teach9" },
          { "source": "dean1", "target": "teach10" },
          { "source": "dean1", "target": "teach11" },
          { "source": "dean1", "target": "teach12" },
          { "source": "dean1", "target": "teach13" }
        ]
      },
      {
        "range": "11.09.2025 – 11.10.2025",
        "staff": [
          { "id": "dean2", "role": "dean", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam3", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam4", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach14", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach15", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach16", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" }
        ],
        "links": [
          { "source": "dean2", "target": "zam3" },
          { "source": "dean2", "target": "zam4" },
          { "source": "dean2", "target": "teach14" },
          { "source": "dean2", "target": "teach15" },
          { "source": "dean2", "target": "teach16" }
        ]
      }
    ];

    // ========== CANVAS РЕНДЕР ==========

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    // загружаем изображения
    const imgCache = {};
    function loadImage(src) {
      if (imgCache[src]) return imgCache[src];
      const img = new Image();
      img.src = src;
      imgCache[src] = img;
      return img;
    }

    // отрисовка графа
    function drawGraph(period) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const staff = period.staff;
      const links = period.links;

      // находим декана (центр)
      const dean = staff.find(s => s.role === "dean");
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      // позиции
      const positions = {};
      positions[dean.id] = { x: centerX, y: centerY };

      // круг для остальных
      const radius = 300;
      const others = staff.filter(s => s.id !== dean.id);
      others.forEach((s, i) => {
        const angle = (i / others.length) * Math.PI * 2;
        positions[s.id] = {
          x: centerX + Math.cos(angle) * radius,
          y: centerY + Math.sin(angle) * radius
        };
      });

      // рисуем связи
      ctx.strokeStyle = "white";
      ctx.lineWidth = 2;
      links.forEach(link => {
        const a = positions[link.source];
        const b = positions[link.target];
        if (!a || !b) return;
        ctx.beginPath();
        ctx.moveTo(a.x, a.y);
        ctx.lineTo(b.x, b.y);
        ctx.stroke();
      });

      // рисуем узлы
      staff.forEach(s => {
        const pos = positions[s.id];
        const img = loadImage(s.img);
        const size = 60;
        ctx.save();
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, size/2, 0, Math.PI*2);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(img, pos.x - size/2, pos.y - size/2, size, size);
        ctx.restore();

        // подпись
        ctx.fillStyle = "white";
        ctx.font = "14px Arial";
        ctx.textAlign = "center";
        ctx.fillText(s.name, pos.x, pos.y + size/2 + 15);
      });
    }

    // ========== КОНТРОЛЫ ==========

    const rangeSelect = document.getElementById("rangeSelect");
    data.forEach((period, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = period.range;
      rangeSelect.appendChild(opt);
    });

    rangeSelect.addEventListener("change", () => {
      drawGraph(data[rangeSelect.value]);
    });

    // рисуем первый по умолчанию
    drawGraph(data[0]);
  </script>
</body>
</html>
