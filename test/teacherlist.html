<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Teacher Graph</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at center, #0b1a2e 0%, #050c16 100%);
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.4);
      padding: 10px;
      border-radius: 8px;
    }
    select {
      padding: 5px;
      font-size: 14px;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="controls">
    <label>Период:</label>
    <select id="rangeSelect"></select>
  </div>
  <canvas id="canvas"></canvas>

  <script>
    // ===== JSON =====
    const data = [
      {
        "range": "11.08.2025 – 11.09.2025",
        "staff": [
          { "id": "dean1", "role": "dean", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam1", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam2", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach1", "role": "teacher", "img": "img/toxic_2k72.png", "name": "Кейт Шэдоу" },
          { "id": "teach2", "role": "teacher", "img": "img/zxczapoy.png", "name": "Кими Старк" },
          { "id": "teach3", "role": "teacher", "img": "img/ranger113.png", "name": "Кирилл Агнес-Степ" },
          { "id": "teach4", "role": "teacher", "img": "img/Tinaida.png", "name": "Тинаида Добренко" },
          { "id": "teach5", "role": "teacher", "img": "img/AkAi_KyOui.png", "name": "Эвелина Алакрити" },
          { "id": "teach6", "role": "teacher", "img": "img/askalinka_mf.png", "name": "Алия Блейз" },
          { "id": "teach7", "role": "teacher", "img": "img/AnnetKariborro.png", "name": "Агнесс Фальконе" },
          { "id": "teach8", "role": "teacher", "img": "img/Boond007.png", "name": "Даниэль Кобблпот" },
          { "id": "teach9", "role": "teacher", "img": "img/new_stalker3.png", "name": "Трафальгар Культапкин" },
          { "id": "teach10", "role": "teacher", "img": "img/klybhuzka.png", "name": "Ирина Коркина-Коннелли" },
          { "id": "teach11", "role": "teacher", "img": "img/GamerProd.png", "name": "Такеши Мейс" },
          { "id": "teach12", "role": "teacher", "img": "img/Abrikos_ikk.png", "name": "Дин Орлеан-Лоусон" },
          { "id": "teach13", "role": "teacher", "img": "img/Prosto_VaraG.png", "name": "Варвара Уайт" }
        ]
      },
      {
        "range": "11.09.2025 – 11.10.2025",
        "staff": [
          { "id": "dean2", "role": "dean", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam3", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "zam4", "role": "zam", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach14", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach15", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" },
          { "id": "teach16", "role": "teacher", "img": "https://upload.wikimedia.org/wikipedia/commons/9/99/Question_book-new.svg", "name": "??" }
        ]
      }
    ];

    // ===== CANVAS =====
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    // кэш изображений
    const imgCache = {};
    function loadImage(src) {
      if (imgCache[src]) return imgCache[src];
      const img = new Image();
      img.src = src;
      imgCache[src] = img;
      return img;
    }

    // ===== РЕНДЕР =====
    let angle = 0;
    let currentPeriod = data[0];

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      const dean = currentPeriod.staff.find(s => s.role === "dean");
      const zams = currentPeriod.staff.filter(s => s.role === "zam");
      const teachers = currentPeriod.staff.filter(s => s.role === "teacher");

      const positions = {};

      // декан
      positions[dean.id] = { x: centerX, y: centerY };
      drawNode(dean, centerX, centerY);

      // замы (малый круг)
      const r1 = 200;
      zams.forEach((s, i) => {
        const a = angle + (i / zams.length) * Math.PI * 2;
        const x = centerX + Math.cos(a) * r1;
        const y = centerY + Math.sin(a) * r1;
        positions[s.id] = { x, y };
        drawNode(s, x, y);
        drawLine(positions[dean.id], { x, y });
      });

      // учителя (большой круг)
      const r2 = 400;
      teachers.forEach((s, i) => {
        const a = -angle + (i / teachers.length) * Math.PI * 2;
        const x = centerX + Math.cos(a) * r2;
        const y = centerY + Math.sin(a) * r2;
        positions[s.id] = { x, y };
        drawNode(s, x, y);
        drawLine(positions[dean.id], { x, y });
      });

      angle += 0.002;
      requestAnimationFrame(draw);
    }

    function drawLine(a, b) {
      ctx.strokeStyle = "rgba(255,255,255,0.4)";
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.stroke();
    }

    function drawNode(s, x, y) {
      const img = loadImage(s.img);
      const size = 60;
      ctx.save();
      ctx.beginPath();
      ctx.arc(x, y, size/2, 0, Math.PI*2);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(img, x - size/2, y - size/2, size, size);
      ctx.restore();

      ctx.fillStyle = "white";
      ctx.font = "14px Arial";
      ctx.textAlign = "center";
      ctx.fillText(s.name, x, y + size/2 + 15);
    }

    // ===== КОНТРОЛЫ =====
    const rangeSelect = document.getElementById("rangeSelect");
    data.forEach((period, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = period.range;
      rangeSelect.appendChild(opt);
    });
    rangeSelect.addEventListener("change", () => {
      currentPeriod = data[rangeSelect.value];
    });

    // старт
    draw();
  </script>
</body>
</html>
